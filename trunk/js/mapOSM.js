var layerCarPath;var layerCarMarkers;function osmInit(f,g,c){try{maps[0]=null;maps[1]=null;if(map!=null){if(map instanceof VEMap){map.Dispose();map=null}else{if(map instanceof GMap2){DisposeMap()}}}if(CURRENT_DIV==HISTORY){var b="theHisMap"}else{var b="theMap"}}catch(d){var b="theMap"}if(map==null){map=new OpenLayers.Map(b,{controls:[new OpenLayers.Control.Navigation(),new OpenLayers.Control.PanZoomBar(),new OpenLayers.Control.LayerSwitcher(),new OpenLayers.Control.Attribution()],maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),maxResolution:156543.0399,numZoomLevels:19,units:"m",projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326")});osmAddMap_Layers()}if(arrMapLocation.length>0){osmOneCarMarker(arrMapLocation[0].mapLat,arrMapLocation[0].mapLon,arrMapLocation[0].speed,arrMapLocation[0].str);var a=map.getZoom();if(a<10){a=10}osmMapCenter(arrMapLocation[0].mapLat,arrMapLocation[0].mapLon,a);osmAddVectorLayer()}else{osmMapCenter(f,g,c);layerCarMarkers.clearMarkers()}}function osmAddMap_Layers(){layerMapnik=new OpenLayers.Layer.OSM.Mapnik("Mapnik");map.addLayer(layerMapnik);layerTilesAtHome=new OpenLayers.Layer.OSM.Osmarender("Osmarender");map.addLayer(layerTilesAtHome);layerCycleMap=new OpenLayers.Layer.OSM.CycleMap("CycleMap");map.addLayer(layerCycleMap);osmAddCar_Layer()}function osmAddCar_Layer(){layerCarMarkers=new OpenLayers.Layer.Markers("Car Marker");map.addLayer(layerCarMarkers)}function osmAddGPX_Layer(a){layerCarPath=new OpenLayers.Layer.GML("GPX Path",a,{format:OpenLayers.Format.GPX,style:{strokeColor:"red",strokeWidth:5,strokeOpacity:0.5},projection:new OpenLayers.Projection("EPSG:4326")});map.addLayer(layerCarPath);osmAddCar_Layer()}function osmAddVectorLayer(){if(layerCarPath!=undefined){layerCarPath.destroy()}if(arrMapLocation.length>1){layerCarPath=new OpenLayers.Layer.Vector("Car Path");var a=[];for(var d=0;d<arrMapLocation.length;d++){var c=new OpenLayers.LonLat(arrMapLocation[d].mapLon,arrMapLocation[d].mapLat).transform(new OpenLayers.Projection("EPSG:4326"),map.getProjectionObject());a.push(new OpenLayers.Geometry.Point(c.lon,c.lat))}var b=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(a),null,{strokeColor:"#FF0000"});map.addLayer(layerCarPath);layerCarPath.addFeatures([b])}}function osmMapCenter(c,d,b){var a=new OpenLayers.LonLat(d,c).transform(new OpenLayers.Projection("EPSG:4326"),map.getProjectionObject());map.setCenter(a,b)}function carIcon(){var b="http://www.openstreetmap.org/openlayers/img/marker.png";var a=new OpenLayers.Size(21,25);var c=new OpenLayers.Pixel(-(a.w/2),-a.h);return new OpenLayers.Icon(b,a,c)}function osmOneCarMarker(c,d,b,a){layerCarMarkers.clearMarkers();osmAddCarMarker(c,d,b,a)}function osmAddCarMarker(h,b,c,j){var g=new OpenLayers.LonLat(b,h).transform(new OpenLayers.Projection("EPSG:4326"),map.getProjectionObject());while(map.popups.length){map.removePopup(map.popups[0])}var k=new OpenLayers.Feature(layerCarMarkers,g);k.closeBox=true;var f=OpenLayers.Class(OpenLayers.Popup.FramedCloud,{autoSize:true});k.popupClass=f;k.data.popupContentHTML=j;k.data.overflow="auto";var l=new OpenLayers.Size(50,50);var d=new OpenLayers.Pixel(-(l.w/2),-l.h);var i=new OpenLayers.Icon(GetImageName(c),l,d);k.data.icon=i;var e=k.createMarker();var a=function(m){if(this.popup==null){this.popup=this.createPopup(this.closeBox);map.addPopup(this.popup,true);this.popup.show()}else{this.popup.toggle()}OpenLayers.Event.stop(m)};e.events.register("mousedown",k,a);layerCarMarkers.addMarker(e)}function osmChangeCarPath(a){if(layerCarPath==undefined){osmAddGPX_Layer(a)}else{layerCarPath.setUrl(a)}}function osmShowCarMarker(){layerCarMarkers.setVisibility(true)}function osmHideCarMarker(){layerCarMarkers.setVisibility(false)}function osmAlternateCarMarker(){layerCarMarkers.setVisibility(!layerCarMarkers.getVisibility())}function osmShowCarPath(){layerCarPath.setVisibility(true)}function osmHideCarPath(){layerCarPath.setVisibility(false)}function osmAlternateCarPath(){layerCarPath.setVisibility(!layerCarPath.getVisibility())}function osmChangeCar(f){var b=10;var e=f.options[f.selectedIndex].value;if(e=="Car1"){var c=38;var d=21.5;var a="test1.gpx.txt"}else{if(e=="Car2"){var c=38.15;var d=22.2;var a="test2.gpx.txt"}else{if(e=="Car3"){var c=37;var d=21.7;var a="test3.gpx.txt"}}}osmMapCenter(c,d,b);osmChangeCarPath(a);osmOneCarMarker(c,d,60,"Sample car")};